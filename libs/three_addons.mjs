/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
import{ExtrudeGeometry as e,ShapePath as t,Ray as i,Plane as r,MathUtils as o,EventDispatcher as n,Vector3 as s,MOUSE as a,TOUCH as l,Quaternion as c,Spherical as h,Vector2 as u,OrthographicCamera as d,BufferGeometry as p,Float32BufferAttribute as m,Mesh as f,ShaderMaterial as g,UniformsUtils as v,WebGLRenderTarget as b,HalfFloatType as x,NoBlending as y,Clock as w,Color as S,AdditiveBlending as M,MeshBasicMaterial as T,Vector4 as C,Box3 as E,Matrix4 as P,Frustum as z,Matrix3 as j,DoubleSide as O,Box2 as R,SRGBColorSpace as A,Camera as L}from"./three.mjs";class _ extends e{constructor(e,t={}){const i=t.font;if(void 0===i)super();else{const r=i.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(r,t)}this.type="TextGeometry"}}class k{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100){const i=[],r=function(e,t,i){const r=Array.from(e),o=t/i.resolution,n=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*o,s=[];let a=0,l=0;for(let e=0;e<r.length;e++){const t=r[e];if("\n"===t)a=0,l-=n;else{const e=D(t,o,a,l,i);a+=e.offsetX,s.push(e.path)}}return s}(e,t,this.data);for(let e=0,t=r.length;e<t;e++)i.push(...r[e].toShapes());return i}}function D(e,i,r,o,n){const s=n.glyphs[e]||n.glyphs["?"];if(!s)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+n.familyName+".");const a=new t;let l,c,h,u,d,p,m,f;if(s.o){const e=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let t=0,n=e.length;t<n;){switch(e[t++]){case"m":l=e[t++]*i+r,c=e[t++]*i+o,a.moveTo(l,c);break;case"l":l=e[t++]*i+r,c=e[t++]*i+o,a.lineTo(l,c);break;case"q":h=e[t++]*i+r,u=e[t++]*i+o,d=e[t++]*i+r,p=e[t++]*i+o,a.quadraticCurveTo(d,p,h,u);break;case"b":h=e[t++]*i+r,u=e[t++]*i+o,d=e[t++]*i+r,p=e[t++]*i+o,m=e[t++]*i+r,f=e[t++]*i+o,a.bezierCurveTo(d,p,m,f,h,u)}}}return{offsetX:s.ha*i,path:a}}const N={type:"change"},B={type:"start"},U={type:"end"},F=new i,I=new r,Y=Math.cos(70*o.DEG2RAD);class H extends n{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new s,this.cursor=new s,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:a.ROTATE,MIDDLE:a.DOLLY,RIGHT:a.PAN},this.touches={ONE:l.ROTATE,TWO:l.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return d.phi},this.getAzimuthalAngle=function(){return d.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",ae),this._domElementKeyEvents=e},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",ae),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(N),i.update(),o=r.NONE},this.resetOrthoPanZoom=function(){f.set(0,0,0),i.object.zoom=1,i.object.updateProjectionMatrix()},this.update=function(){const t=new s,a=(new c).setFromUnitVectors(e.up,new s(0,1,0)),l=a.clone().invert(),h=new s,u=new c,g=new s,v=2*Math.PI;return function(c=null){const b=i.object.position;t.copy(b).sub(i.target),t.applyQuaternion(a),d.setFromVector3(t),i.autoRotate&&o===r.NONE&&A(function(e){return null!==e?2*Math.PI/60*i.autoRotateSpeed*e:2*Math.PI/60/60*i.autoRotateSpeed}(c)),i.enableDamping?(d.theta+=p.theta*i.dampingFactor,d.phi+=p.phi*i.dampingFactor):(d.theta+=p.theta,d.phi+=p.phi);let x=i.minAzimuthAngle,y=i.maxAzimuthAngle;isFinite(x)&&isFinite(y)&&(x<-Math.PI?x+=v:x>Math.PI&&(x-=v),y<-Math.PI?y+=v:y>Math.PI&&(y-=v),d.theta=x<=y?Math.max(x,Math.min(y,d.theta)):d.theta>(x+y)/2?Math.max(x,d.theta):Math.min(y,d.theta)),d.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,d.phi)),d.makeSafe(),!0===i.enableDamping?i.target.addScaledVector(f,i.dampingFactor):i.target.add(f),i.target.sub(i.cursor),i.target.clampLength(i.minTargetRadius,i.maxTargetRadius),i.target.add(i.cursor);let w=!1;if(i.zoomToCursor&&P||i.object.isOrthographicCamera)d.radius=K(d.radius);else{const e=d.radius;d.radius=K(d.radius*m),w=e!=d.radius}if(t.setFromSpherical(d),t.applyQuaternion(l),b.copy(i.target).add(t),i.object.lookAt(i.target),!0===i.enableDamping?(p.theta*=1-i.dampingFactor,p.phi*=1-i.dampingFactor,f.multiplyScalar(1-i.dampingFactor)):(p.set(0,0,0),f.set(0,0,0)),i.zoomToCursor&&P){let r=null;if(i.object.isPerspectiveCamera){const e=t.length();r=K(e*m);const o=e-r;i.object.position.addScaledVector(C,o),i.object.updateMatrixWorld(),w=!!o}else if(i.object.isOrthographicCamera){const e=new s(E.x,E.y,0);e.unproject(i.object);const o=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/m)),i.object.updateProjectionMatrix(),w=o!==i.object.zoom;const n=new s(E.x,E.y,0);n.unproject(i.object),i.object.position.sub(n).add(e),i.object.updateMatrixWorld(),r=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;null!==r&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(r).add(i.object.position):(F.origin.copy(i.object.position),F.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(F.direction))<Y?e.lookAt(i.target):(I.setFromNormalAndCoplanarPoint(i.object.up,i.target),F.intersectPlane(I,i.target))))}else if(i.object.isOrthographicCamera){const e=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/m)),e!==i.object.zoom&&(i.object.updateProjectionMatrix(),w=!0)}return m=1,P=!1,!!(w||h.distanceToSquared(i.object.position)>n||8*(1-u.dot(i.object.quaternion))>n||g.distanceToSquared(i.target)>n)&&(i.dispatchEvent(N),h.copy(i.object.position),u.copy(i.object.quaternion),g.copy(i.target),!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",ce),i.domElement.removeEventListener("pointerdown",te),i.domElement.removeEventListener("pointercancel",re),i.domElement.removeEventListener("wheel",oe),i.domElement.removeEventListener("pointermove",ie),i.domElement.removeEventListener("pointerup",re);i.domElement.getRootNode().removeEventListener("keydown",ne,{capture:!0}),null!==i._domElementKeyEvents&&(i._domElementKeyEvents.removeEventListener("keydown",ae),i._domElementKeyEvents=null)};const i=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=r.NONE;const n=1e-6,d=new h,p=new h;let m=1;const f=new s,g=new u,v=new u,b=new u,x=new u,y=new u,w=new u,S=new u,M=new u,T=new u,C=new s,E=new u;let P=!1;const z=[],j={};let O=!1;function R(e){const t=Math.abs(.01*e);return Math.pow(.95,i.zoomSpeed*t)}function A(e){p.theta-=e}function L(e){p.phi-=e}const _=function(){const e=new s;return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),f.add(e)}}(),k=function(){const e=new s;return function(t,r){!0===i.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),f.add(e)}}(),D=function(){const e=new s;return function(t,r){const o=i.domElement;if(i.object.isPerspectiveCamera){const n=i.object.position;e.copy(n).sub(i.target);let s=e.length();s*=Math.tan(i.object.fov/2*Math.PI/180),_(2*t*s/o.clientHeight,i.object.matrix),k(2*r*s/o.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(_(t*(i.object.right-i.object.left)/i.object.zoom/o.clientWidth,i.object.matrix),k(r*(i.object.top-i.object.bottom)/i.object.zoom/o.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function H(e){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?m/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function V(e){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?m*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function W(e,t){if(!i.zoomToCursor)return;P=!0;const r=i.domElement.getBoundingClientRect(),o=e-r.left,n=t-r.top,s=r.width,a=r.height;E.x=o/s*2-1,E.y=-n/a*2+1,C.set(E.x,E.y,1).unproject(i.object).sub(i.object.position).normalize()}function K(e){return Math.max(i.minDistance,Math.min(i.maxDistance,e))}function X(e){g.set(e.clientX,e.clientY)}function Q(e){x.set(e.clientX,e.clientY)}function Z(e){if(1===z.length)g.set(e.pageX,e.pageY);else{const t=ue(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);g.set(i,r)}}function G(e){if(1===z.length)x.set(e.pageX,e.pageY);else{const t=ue(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);x.set(i,r)}}function q(e){const t=ue(e),i=e.pageX-t.x,r=e.pageY-t.y,o=Math.sqrt(i*i+r*r);S.set(0,o)}function J(e){if(1==z.length)v.set(e.pageX,e.pageY);else{const t=ue(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);v.set(i,r)}b.subVectors(v,g).multiplyScalar(i.rotateSpeed);const t=i.domElement;A(2*Math.PI*b.x/t.clientHeight),L(2*Math.PI*b.y/t.clientHeight),g.copy(v)}function $(e){if(1===z.length)y.set(e.pageX,e.pageY);else{const t=ue(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);y.set(i,r)}w.subVectors(y,x).multiplyScalar(i.panSpeed),D(w.x,w.y),x.copy(y)}function ee(e){const t=ue(e),r=e.pageX-t.x,o=e.pageY-t.y,n=Math.sqrt(r*r+o*o);M.set(0,n),T.set(0,Math.pow(M.y/S.y,i.zoomSpeed)),H(T.y),S.copy(M);W(.5*(e.pageX+t.x),.5*(e.pageY+t.y))}function te(e){!1!==i.enabled&&(0===z.length&&(i.domElement.setPointerCapture(e.pointerId),i.domElement.addEventListener("pointermove",ie),i.domElement.addEventListener("pointerup",re)),function(e){for(let t=0;t<z.length;t++)if(z[t]==e.pointerId)return!0;return!1}(e)||(function(e){z.push(e.pointerId)}(e),"touch"===e.pointerType?le(e):function(e){let t;switch(e.button){case 0:t=i.mouseButtons.LEFT;break;case 1:t=i.mouseButtons.MIDDLE;break;case 2:t=i.mouseButtons.RIGHT;break;default:t=-1}switch(t){case a.DOLLY:if(!1===i.enableZoom)return;!function(e){W(e.clientX,e.clientX),S.set(e.clientX,e.clientY)}(e),o=r.DOLLY;break;case a.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;Q(e),o=r.PAN}else{if(!1===i.enableRotate)return;X(e),o=r.ROTATE}break;case a.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;X(e),o=r.ROTATE}else{if(!1===i.enablePan)return;Q(e),o=r.PAN}break;default:o=r.NONE}o!==r.NONE&&i.dispatchEvent(B)}(e)))}function ie(e){!1!==i.enabled&&("touch"===e.pointerType?function(e){switch(he(e),o){case r.TOUCH_ROTATE:if(!1===i.enableRotate)return;J(e),i.update();break;case r.TOUCH_PAN:if(!1===i.enablePan)return;$(e),i.update();break;case r.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(e){i.enableZoom&&ee(e),i.enablePan&&$(e)}(e),i.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(e){i.enableZoom&&ee(e),i.enableRotate&&J(e)}(e),i.update();break;default:o=r.NONE}}(e):function(e){switch(o){case r.ROTATE:if(!1===i.enableRotate)return;!function(e){v.set(e.clientX,e.clientY),b.subVectors(v,g).multiplyScalar(i.rotateSpeed);const t=i.domElement;A(2*Math.PI*b.x/t.clientHeight),L(2*Math.PI*b.y/t.clientHeight),g.copy(v),i.update()}(e);break;case r.DOLLY:if(!1===i.enableZoom)return;!function(e){M.set(e.clientX,e.clientY),T.subVectors(M,S),T.y>0?H(R(T.y)):T.y<0&&V(R(T.y)),S.copy(M),i.update()}(e);break;case r.PAN:if(!1===i.enablePan)return;!function(e){y.set(e.clientX,e.clientY),w.subVectors(y,x).multiplyScalar(i.panSpeed),D(w.x,w.y),x.copy(y),i.update()}(e)}}(e))}function re(e){switch(function(e){delete j[e.pointerId];for(let t=0;t<z.length;t++)if(z[t]==e.pointerId)return void z.splice(t,1)}(e),z.length){case 0:i.domElement.releasePointerCapture(e.pointerId),i.domElement.removeEventListener("pointermove",ie),i.domElement.removeEventListener("pointerup",re),i.dispatchEvent(U),o=r.NONE;break;case 1:const t=z[0],n=j[t];le({pointerId:t,pageX:n.x,pageY:n.y})}}function oe(e){!1!==i.enabled&&!1!==i.enableZoom&&o===r.NONE&&(e.preventDefault(),i.dispatchEvent(B),function(e){W(e.clientX,e.clientY),e.deltaY<0?V(R(e.deltaY)):e.deltaY>0&&H(R(e.deltaY)),i.update()}(function(e){const t=e.deltaMode,i={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100}e.ctrlKey&&!O&&(i.deltaY*=10);return i}(e)),i.dispatchEvent(U))}function ne(e){if("Control"===e.key){O=!0;i.domElement.getRootNode().addEventListener("keyup",se,{passive:!0,capture:!0})}}function se(e){if("Control"===e.key){O=!1;i.domElement.getRootNode().removeEventListener("keyup",se,{passive:!0,capture:!0})}}function ae(e){!1!==i.enabled&&!1!==i.enablePan&&function(e){let t=!1;switch(e.code){case i.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?L(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):D(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?L(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):D(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?A(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):D(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?A(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):D(-i.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),i.update())}(e)}function le(e){switch(he(e),z.length){case 1:switch(i.touches.ONE){case l.ROTATE:if(!1===i.enableRotate)return;Z(e),o=r.TOUCH_ROTATE;break;case l.PAN:if(!1===i.enablePan)return;G(e),o=r.TOUCH_PAN;break;default:o=r.NONE}break;case 2:switch(i.touches.TWO){case l.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(e){i.enableZoom&&q(e),i.enablePan&&G(e)}(e),o=r.TOUCH_DOLLY_PAN;break;case l.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(e){i.enableZoom&&q(e),i.enableRotate&&Z(e)}(e),o=r.TOUCH_DOLLY_ROTATE;break;default:o=r.NONE}break;default:o=r.NONE}o!==r.NONE&&i.dispatchEvent(B)}function ce(e){!1!==i.enabled&&e.preventDefault()}function he(e){let t=j[e.pointerId];void 0===t&&(t=new u,j[e.pointerId]=t),t.set(e.pageX,e.pageY)}function ue(e){const t=e.pointerId===z[0]?z[1]:z[0];return j[t]}i.domElement.addEventListener("contextmenu",ce),i.domElement.addEventListener("pointerdown",te),i.domElement.addEventListener("pointercancel",re),i.domElement.addEventListener("wheel",oe,{passive:!1});i.domElement.getRootNode().addEventListener("keydown",ne,{passive:!0,capture:!0}),this.update()}}const V={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}"};class W{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const K=new d(-1,1,1,-1,0,1);const X=new class extends p{constructor(){super(),this.setAttribute("position",new m([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new m([0,2,0,0,2,0],2))}};class Q{constructor(e){this._mesh=new f(X,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,K)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Z extends W{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof g?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=v.clone(e.uniforms),this.material=new g({name:void 0!==e.name?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Q(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class G extends W{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const r=e.getContext(),o=e.state;let n,s;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(n=0,s=1):(n=1,s=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),o.buffers.stencil.setFunc(r.ALWAYS,n,4294967295),o.buffers.stencil.setClear(s),o.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.color.setMask(!0),o.buffers.depth.setMask(!0),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(r.EQUAL,1,4294967295),o.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),o.buffers.stencil.setLocked(!0)}}class q extends W{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class J{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),void 0===t){const i=e.getSize(new u);this._width=i.width,this._height=i.height,(t=new b(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:x})).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Z(V),this.copyPass.material.blending=y,this.clock=new w}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let t=0,r=this.passes.length;t<r;t++){const r=this.passes[t];if(!1!==r.enabled){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),r.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),r.needsSwap){if(i){const t=this.renderer.getContext(),i=this.renderer.state.buffers.stencil;i.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),i.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==G&&(r instanceof G?i=!0:r instanceof q&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new u);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(i,r),this.renderTarget2.setSize(i,r);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(i,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class $ extends W{constructor(e,t,i=null,r=null,o=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=r,this.clearAlpha=o,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new S}render(e,t,i){const r=e.autoClear;let o,n;e.autoClear=!1,null!==this.overrideMaterial&&(n=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor)),null!==this.clearAlpha&&(o=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),1==this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),!0===this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),null!==this.clearColor&&e.setClearColor(this._oldClearColor),null!==this.clearAlpha&&e.setClearAlpha(o),null!==this.overrideMaterial&&(this.scene.overrideMaterial=n),e.autoClear=r}}class ee{constructor(e=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(let e=0;e<512;e++)this.perm[e]=this.p[255&e];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(e,t,i){return e[0]*t+e[1]*i}dot3(e,t,i,r){return e[0]*t+e[1]*i+e[2]*r}dot4(e,t,i,r,o){return e[0]*t+e[1]*i+e[2]*r+e[3]*o}noise(e,t){let i,r,o;const n=(e+t)*(.5*(Math.sqrt(3)-1)),s=Math.floor(e+n),a=Math.floor(t+n),l=(3-Math.sqrt(3))/6,c=(s+a)*l,h=e-(s-c),u=t-(a-c);let d,p;h>u?(d=1,p=0):(d=0,p=1);const m=h-d+l,f=u-p+l,g=h-1+2*l,v=u-1+2*l,b=255&s,x=255&a,y=this.perm[b+this.perm[x]]%12,w=this.perm[b+d+this.perm[x+p]]%12,S=this.perm[b+1+this.perm[x+1]]%12;let M=.5-h*h-u*u;M<0?i=0:(M*=M,i=M*M*this.dot(this.grad3[y],h,u));let T=.5-m*m-f*f;T<0?r=0:(T*=T,r=T*T*this.dot(this.grad3[w],m,f));let C=.5-g*g-v*v;return C<0?o=0:(C*=C,o=C*C*this.dot(this.grad3[S],g,v)),70*(i+r+o)}noise3d(e,t,i){let r,o,n,s;const a=(e+t+i)*(1/3),l=Math.floor(e+a),c=Math.floor(t+a),h=Math.floor(i+a),u=1/6,d=(l+c+h)*u,p=e-(l-d),m=t-(c-d),f=i-(h-d);let g,v,b,x,y,w;p>=m?m>=f?(g=1,v=0,b=0,x=1,y=1,w=0):p>=f?(g=1,v=0,b=0,x=1,y=0,w=1):(g=0,v=0,b=1,x=1,y=0,w=1):m<f?(g=0,v=0,b=1,x=0,y=1,w=1):p<f?(g=0,v=1,b=0,x=0,y=1,w=1):(g=0,v=1,b=0,x=1,y=1,w=0);const S=p-g+u,M=m-v+u,T=f-b+u,C=p-x+2*u,E=m-y+2*u,P=f-w+2*u,z=p-1+.5,j=m-1+.5,O=f-1+.5,R=255&l,A=255&c,L=255&h,_=this.perm[R+this.perm[A+this.perm[L]]]%12,k=this.perm[R+g+this.perm[A+v+this.perm[L+b]]]%12,D=this.perm[R+x+this.perm[A+y+this.perm[L+w]]]%12,N=this.perm[R+1+this.perm[A+1+this.perm[L+1]]]%12;let B=.6-p*p-m*m-f*f;B<0?r=0:(B*=B,r=B*B*this.dot3(this.grad3[_],p,m,f));let U=.6-S*S-M*M-T*T;U<0?o=0:(U*=U,o=U*U*this.dot3(this.grad3[k],S,M,T));let F=.6-C*C-E*E-P*P;F<0?n=0:(F*=F,n=F*F*this.dot3(this.grad3[D],C,E,P));let I=.6-z*z-j*j-O*O;return I<0?s=0:(I*=I,s=I*I*this.dot3(this.grad3[N],z,j,O)),32*(r+o+n+s)}noise4d(e,t,i,r){const o=this.grad4,n=this.simplex,s=this.perm,a=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;let c,h,u,d,p;const m=(e+t+i+r)*a,f=Math.floor(e+m),g=Math.floor(t+m),v=Math.floor(i+m),b=Math.floor(r+m),x=(f+g+v+b)*l,y=e-(f-x),w=t-(g-x),S=i-(v-x),M=r-(b-x),T=(y>w?32:0)+(y>S?16:0)+(w>S?8:0)+(y>M?4:0)+(w>M?2:0)+(S>M?1:0),C=n[T][0]>=3?1:0,E=n[T][1]>=3?1:0,P=n[T][2]>=3?1:0,z=n[T][3]>=3?1:0,j=n[T][0]>=2?1:0,O=n[T][1]>=2?1:0,R=n[T][2]>=2?1:0,A=n[T][3]>=2?1:0,L=n[T][0]>=1?1:0,_=n[T][1]>=1?1:0,k=n[T][2]>=1?1:0,D=n[T][3]>=1?1:0,N=y-C+l,B=w-E+l,U=S-P+l,F=M-z+l,I=y-j+2*l,Y=w-O+2*l,H=S-R+2*l,V=M-A+2*l,W=y-L+3*l,K=w-_+3*l,X=S-k+3*l,Q=M-D+3*l,Z=y-1+4*l,G=w-1+4*l,q=S-1+4*l,J=M-1+4*l,$=255&f,ee=255&g,te=255&v,ie=255&b,re=s[$+s[ee+s[te+s[ie]]]]%32,oe=s[$+C+s[ee+E+s[te+P+s[ie+z]]]]%32,ne=s[$+j+s[ee+O+s[te+R+s[ie+A]]]]%32,se=s[$+L+s[ee+_+s[te+k+s[ie+D]]]]%32,ae=s[$+1+s[ee+1+s[te+1+s[ie+1]]]]%32;let le=.6-y*y-w*w-S*S-M*M;le<0?c=0:(le*=le,c=le*le*this.dot4(o[re],y,w,S,M));let ce=.6-N*N-B*B-U*U-F*F;ce<0?h=0:(ce*=ce,h=ce*ce*this.dot4(o[oe],N,B,U,F));let he=.6-I*I-Y*Y-H*H-V*V;he<0?u=0:(he*=he,u=he*he*this.dot4(o[ne],I,Y,H,V));let ue=.6-W*W-K*K-X*X-Q*Q;ue<0?d=0:(ue*=ue,d=ue*ue*this.dot4(o[se],W,K,X,Q));let de=.6-Z*Z-G*G-q*q-J*J;return de<0?p=0:(de*=de,p=de*de*this.dot4(o[ae],Z,G,q,J)),27*(c+h+u+d+p)}}const te={name:"LuminosityHighPassShader",shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new S(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tvec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n\t\t\tfloat v = dot( texel.xyz, luma );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};class ie extends W{constructor(e,t,i,r){super(),this.strength=void 0!==t?t:1,this.radius=i,this.threshold=r,this.resolution=void 0!==e?new u(e.x,e.y):new u(256,256),this.clearColor=new S(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let o=Math.round(this.resolution.x/2),n=Math.round(this.resolution.y/2);this.renderTargetBright=new b(o,n,{type:x}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let e=0;e<this.nMips;e++){const t=new b(o,n,{type:x});t.texture.name="UnrealBloomPass.h"+e,t.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(t);const i=new b(o,n,{type:x});i.texture.name="UnrealBloomPass.v"+e,i.texture.generateMipmaps=!1,this.renderTargetsVertical.push(i),o=Math.round(o/2),n=Math.round(n/2)}const a=te;this.highPassUniforms=v.clone(a.uniforms),this.highPassUniforms.luminosityThreshold.value=r,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new g({uniforms:this.highPassUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),this.separableBlurMaterials=[];const l=[3,5,7,9,11];o=Math.round(this.resolution.x/2),n=Math.round(this.resolution.y/2);for(let e=0;e<this.nMips;e++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(l[e])),this.separableBlurMaterials[e].uniforms.invSize.value=new u(1/o,1/n),o=Math.round(o/2),n=Math.round(n/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new s(1,1,1),new s(1,1,1),new s(1,1,1),new s(1,1,1),new s(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const c=V;this.copyUniforms=v.clone(c.uniforms),this.blendMaterial=new g({uniforms:this.copyUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:M,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new S,this.oldClearAlpha=1,this.basic=new T,this.fsQuad=new Q(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,t){let i=Math.round(e/2),r=Math.round(t/2);this.renderTargetBright.setSize(i,r);for(let e=0;e<this.nMips;e++)this.renderTargetsHorizontal[e].setSize(i,r),this.renderTargetsVertical[e].setSize(i,r),this.separableBlurMaterials[e].uniforms.invSize.value=new u(1/i,1/r),i=Math.round(i/2),r=Math.round(r/2)}render(e,t,i,r,o){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const n=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),o&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=i.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=i.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let s=this.renderTargetBright;for(let t=0;t<this.nMips;t++)this.fsQuad.material=this.separableBlurMaterials[t],this.separableBlurMaterials[t].uniforms.colorTexture.value=s.texture,this.separableBlurMaterials[t].uniforms.direction.value=ie.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[t]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[t].uniforms.colorTexture.value=this.renderTargetsHorizontal[t].texture,this.separableBlurMaterials[t].uniforms.direction.value=ie.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[t]),e.clear(),this.fsQuad.render(e),s=this.renderTargetsVertical[t];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,o&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(i),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=n}getSeperableBlurMaterial(e){const t=[];for(let i=0;i<e;i++)t.push(.39894*Math.exp(-.5*i*i/(e*e))/e);return new g({defines:{KERNEL_RADIUS:e},uniforms:{colorTexture:{value:null},invSize:{value:new u(.5,.5)},direction:{value:new u(.5,.5)},gaussianCoefficients:{value:t}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 invSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float gaussianCoefficients[KERNEL_RADIUS];\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat weightSum = gaussianCoefficients[0];\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianCoefficients[i];\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(e){return new g({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}ie.BlurDirectionX=new u(1,0),ie.BlurDirectionY=new u(0,1);class re{constructor(){this.id=0,this.object=null,this.z=0,this.renderOrder=0}}class oe{constructor(){this.id=0,this.v1=new ne,this.v2=new ne,this.v3=new ne,this.normalModel=new s,this.vertexNormalsModel=[new s,new s,new s],this.vertexNormalsLength=0,this.color=new S,this.material=null,this.uvs=[new u,new u,new u],this.z=0,this.renderOrder=0}}class ne{constructor(){this.position=new s,this.positionWorld=new s,this.positionScreen=new C,this.visible=!0}copy(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)}}class se{constructor(){this.id=0,this.v1=new ne,this.v2=new ne,this.vertexColors=[new S,new S],this.material=null,this.z=0,this.renderOrder=0}}class ae{constructor(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new u,this.material=null,this.renderOrder=0}}class le{constructor(){let e,t,i,r,o,n,a,l,c,h,u,d=0,p=0,m=0,f=0,g=0;const v={objects:[],lights:[],elements:[]},b=new s,x=new C,y=new E(new s(-1,-1,-1),new s(1,1,1)),w=new E,S=new Array(3),M=new P,T=new P,R=new P,A=new z,L=[],_=[],k=[],D=[],N=[];const B=new function(){const e=[],t=[],s=[];let c=null;const h=new j;function d(e){const t=e.position,i=e.positionWorld,r=e.positionScreen;i.copy(t).applyMatrix4(u),r.copy(i).applyMatrix4(T);const o=1/r.w;r.x*=o,r.y*=o,r.z*=o,e.visible=r.x>=-1&&r.x<=1&&r.y>=-1&&r.y<=1&&r.z>=-1&&r.z<=1}function g(e,t,i){return!0===e.visible||!0===t.visible||!0===i.visible||(S[0]=e.positionScreen,S[1]=t.positionScreen,S[2]=i.positionScreen,y.intersectsBox(w.setFromPoints(S)))}function M(e,t,i){return(i.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(i.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(i){c=i,h.getNormalMatrix(c.matrixWorld),e.length=0,t.length=0,s.length=0},projectVertex:d,checkTriangleVisibility:g,checkBackfaceCulling:M,pushVertex:function(e,t,o){i=function(){if(r===p){const e=new ne;return _.push(e),p++,r++,e}return _[r++]}(),i.position.set(e,t,o),d(i)},pushNormal:function(t,i,r){e.push(t,i,r)},pushColor:function(e,i,r){t.push(e,i,r)},pushUv:function(e,t){s.push(e,t)},pushLine:function(e,i){const r=_[e],o=_[i];r.positionScreen.copy(r.position).applyMatrix4(R),o.positionScreen.copy(o.position).applyMatrix4(R),!0===function(e,t){let i=0,r=1;const o=e.z+e.w,n=t.z+t.w,s=-e.z+e.w,a=-t.z+t.w;return o>=0&&n>=0&&s>=0&&a>=0||!(o<0&&n<0||s<0&&a<0)&&(o<0?i=Math.max(i,o/(o-n)):n<0&&(r=Math.min(r,o/(o-n))),s<0?i=Math.max(i,s/(s-a)):a<0&&(r=Math.min(r,s/(s-a))),!(r<i)&&(e.lerp(t,i),t.lerp(e,1-r),!0))}(r.positionScreen,o.positionScreen)&&(r.positionScreen.multiplyScalar(1/r.positionScreen.w),o.positionScreen.multiplyScalar(1/o.positionScreen.w),a=function(){if(l===f){const e=new se;return D.push(e),f++,l++,e}return D[l++]}(),a.id=c.id,a.v1.copy(r),a.v2.copy(o),a.z=Math.max(r.positionScreen.z,o.positionScreen.z),a.renderOrder=c.renderOrder,a.material=c.material,c.material.vertexColors&&(a.vertexColors[0].fromArray(t,3*e),a.vertexColors[1].fromArray(t,3*i)),v.elements.push(a))},pushTriangle:function(i,r,a,l){const u=_[i],d=_[r],p=_[a];if(!1!==g(u,d,p)&&(l.side===O||!0===M(u,d,p))){o=function(){if(n===m){const e=new oe;return k.push(e),m++,n++,e}return k[n++]}(),o.id=c.id,o.v1.copy(u),o.v2.copy(d),o.v3.copy(p),o.z=(u.positionScreen.z+d.positionScreen.z+p.positionScreen.z)/3,o.renderOrder=c.renderOrder,b.subVectors(p.position,d.position),x.subVectors(u.position,d.position),b.cross(x),o.normalModel.copy(b),o.normalModel.applyMatrix3(h).normalize();for(let t=0;t<3;t++){const i=o.vertexNormalsModel[t];i.fromArray(e,3*arguments[t]),i.applyMatrix3(h).normalize();o.uvs[t].fromArray(s,2*arguments[t])}o.vertexNormalsLength=3,o.material=l,l.vertexColors&&o.color.fromArray(t,3*i),v.elements.push(o)}}}};function U(e){if(!1===e.visible)return;if(e.isLight)v.lights.push(e);else if(e.isMesh||e.isLine||e.isPoints){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===A.intersectsObject(e))return;F(e)}else if(e.isSprite){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===A.intersectsSprite(e))return;F(e)}const t=e.children;for(let e=0,i=t.length;e<i;e++)U(t[e])}function F(i){e=function(){if(t===d){const e=new re;return L.push(e),d++,t++,e}return L[t++]}(),e.id=i.id,e.object=i,b.setFromMatrixPosition(i.matrixWorld),b.applyMatrix4(T),e.z=b.z,e.renderOrder=i.renderOrder,v.objects.push(e)}function I(e,t,i){const r=1/e.w;e.z*=r,e.z>=-1&&e.z<=1&&(c=function(){if(h===g){const e=new ae;return N.push(e),g++,h++,e}return N[h++]}(),c.id=t.id,c.x=e.x*r,c.y=e.y*r,c.z=e.z,c.renderOrder=t.renderOrder,c.object=t,c.rotation=t.rotation,c.scale.x=t.scale.x*Math.abs(c.x-(e.x+i.projectionMatrix.elements[0])/(e.w+i.projectionMatrix.elements[12])),c.scale.y=t.scale.y*Math.abs(c.y-(e.y+i.projectionMatrix.elements[5])/(e.w+i.projectionMatrix.elements[13])),c.material=t.material,v.elements.push(c))}function Y(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}this.projectScene=function(e,i,o,s){n=0,l=0,h=0,v.elements.length=0,!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===i.parent&&!0===i.matrixWorldAutoUpdate&&i.updateMatrixWorld(),M.copy(i.matrixWorldInverse),T.multiplyMatrices(i.projectionMatrix,M),A.setFromProjectionMatrix(T),t=0,v.objects.length=0,v.lights.length=0,U(e),!0===o&&v.objects.sort(Y);const a=v.objects;for(let e=0,t=a.length;e<t;e++){const t=a[e].object,o=t.geometry;if(B.setObject(t),u=t.matrixWorld,r=0,t.isMesh){let e=t.material;const i=Array.isArray(e),r=o.attributes,n=o.groups;if(void 0===r.position)continue;const s=r.position.array;for(let e=0,i=s.length;e<i;e+=3){let i=s[e],r=s[e+1],n=s[e+2];const a=o.morphAttributes.position;if(void 0!==a){const l=o.morphTargetsRelative,c=t.morphTargetInfluences;for(let t=0,o=a.length;t<o;t++){const o=c[t];if(0===o)continue;const h=a[t];l?(i+=h.getX(e/3)*o,r+=h.getY(e/3)*o,n+=h.getZ(e/3)*o):(i+=(h.getX(e/3)-s[e])*o,r+=(h.getY(e/3)-s[e+1])*o,n+=(h.getZ(e/3)-s[e+2])*o)}}B.pushVertex(i,r,n)}if(void 0!==r.normal){const e=r.normal.array;for(let t=0,i=e.length;t<i;t+=3)B.pushNormal(e[t],e[t+1],e[t+2])}if(void 0!==r.color){const e=r.color.array;for(let t=0,i=e.length;t<i;t+=3)B.pushColor(e[t],e[t+1],e[t+2])}if(void 0!==r.uv){const e=r.uv.array;for(let t=0,i=e.length;t<i;t+=2)B.pushUv(e[t],e[t+1])}if(null!==o.index){const r=o.index.array;if(n.length>0)for(let o=0;o<n.length;o++){const s=n[o];if(e=!0===i?t.material[s.materialIndex]:t.material,void 0!==e)for(let t=s.start,i=s.start+s.count;t<i;t+=3)B.pushTriangle(r[t],r[t+1],r[t+2],e)}else for(let t=0,i=r.length;t<i;t+=3)B.pushTriangle(r[t],r[t+1],r[t+2],e)}else if(n.length>0)for(let r=0;r<n.length;r++){const o=n[r];if(e=!0===i?t.material[o.materialIndex]:t.material,void 0!==e)for(let t=o.start,i=o.start+o.count;t<i;t+=3)B.pushTriangle(t,t+1,t+2,e)}else for(let t=0,i=s.length/3;t<i;t+=3)B.pushTriangle(t,t+1,t+2,e)}else if(t.isLine){R.multiplyMatrices(T,u);const e=o.attributes;if(void 0!==e.position){const i=e.position.array;for(let e=0,t=i.length;e<t;e+=3)B.pushVertex(i[e],i[e+1],i[e+2]);if(void 0!==e.color){const t=e.color.array;for(let e=0,i=t.length;e<i;e+=3)B.pushColor(t[e],t[e+1],t[e+2])}if(null!==o.index){const e=o.index.array;for(let t=0,i=e.length;t<i;t+=2)B.pushLine(e[t],e[t+1])}else{const e=t.isLineSegments?2:1;for(let t=0,r=i.length/3-1;t<r;t+=e)B.pushLine(t,t+1)}}}else if(t.isPoints){R.multiplyMatrices(T,u);const e=o.attributes;if(void 0!==e.position){const r=e.position.array;for(let e=0,o=r.length;e<o;e+=3)x.set(r[e],r[e+1],r[e+2],1),x.applyMatrix4(R),I(x,t,i)}}else t.isSprite&&(t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),x.set(u.elements[12],u.elements[13],u.elements[14],1),x.applyMatrix4(T),I(x,t,i))}return!0===s&&v.elements.sort(Y),v}}}class ce{constructor(){let e,t,i,r,o,n,a,l,c,h,u,d,p,m=0,f=null,g=1;const v=this,b=new R,x=new R,y=new S,w=new S,M=new S,T=new S,C=new S,E=new S,z=new s,O=new s,_=new s,k=new j,D=new P,N=new P,B=[],U=new le,F=document.createElementNS("http://www.w3.org/2000/svg","svg");function I(){for(m=0;F.childNodes.length>0;)F.removeChild(F.childNodes[0])}function Y(e){return null!==f?e.toFixed(f):e}function H(e,t,i){let r=t.scale.x*n,o=t.scale.y*a;i.isPointsMaterial&&(r*=i.size,o*=i.size);const s="M"+Y(e.x-.5*r)+","+Y(e.y-.5*o)+"h"+Y(r)+"v"+Y(o)+"h"+Y(-r)+"z";let l="";(i.isSpriteMaterial||i.isPointsMaterial)&&(l="fill:"+i.color.getStyle(v.outputColorSpace)+";fill-opacity:"+i.opacity),X(l,s)}function V(e,t,i){const r="M"+Y(e.positionScreen.x)+","+Y(e.positionScreen.y)+"L"+Y(t.positionScreen.x)+","+Y(t.positionScreen.y);if(i.isLineBasicMaterial){let e="fill:none;stroke:"+i.color.getStyle(v.outputColorSpace)+";stroke-opacity:"+i.opacity+";stroke-width:"+i.linewidth+";stroke-linecap:"+i.linecap;i.isLineDashedMaterial&&(e=e+";stroke-dasharray:"+i.dashSize+","+i.gapSize),X(e,r)}}function W(e,t,r,o,n){v.info.render.vertices+=3,v.info.render.faces++;const s="M"+Y(e.positionScreen.x)+","+Y(e.positionScreen.y)+"L"+Y(t.positionScreen.x)+","+Y(t.positionScreen.y)+"L"+Y(r.positionScreen.x)+","+Y(r.positionScreen.y)+"z";let a="";n.isMeshBasicMaterial?(y.copy(n.color),n.vertexColors&&y.multiply(o.color)):n.isMeshLambertMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial?(w.copy(n.color),n.vertexColors&&w.multiply(o.color),y.copy(M),O.copy(e.positionWorld).add(t.positionWorld).add(r.positionWorld).divideScalar(3),function(e,t,i,r){for(let o=0,n=e.length;o<n;o++){const n=e[o],s=n.color;if(n.isDirectionalLight){const e=z.setFromMatrixPosition(n.matrixWorld).normalize();let t=i.dot(e);if(t<=0)continue;t*=n.intensity,r.r+=s.r*t,r.g+=s.g*t,r.b+=s.b*t}else if(n.isPointLight){const e=z.setFromMatrixPosition(n.matrixWorld);let o=i.dot(z.subVectors(e,t).normalize());if(o<=0)continue;if(o*=0==n.distance?1:1-Math.min(t.distanceTo(e)/n.distance,1),0==o)continue;o*=n.intensity,r.r+=s.r*o,r.g+=s.g*o,r.b+=s.b*o}}}(i,O,o.normalModel,y),y.multiply(w).add(n.emissive)):n.isMeshNormalMaterial&&(_.copy(o.normalModel).applyMatrix3(k).normalize(),y.setRGB(_.x,_.y,_.z).multiplyScalar(.5).addScalar(.5)),a=n.wireframe?"fill:none;stroke:"+y.getStyle(v.outputColorSpace)+";stroke-opacity:"+n.opacity+";stroke-width:"+n.wireframeLinewidth+";stroke-linecap:"+n.wireframeLinecap+";stroke-linejoin:"+n.wireframeLinejoin:"fill:"+y.getStyle(v.outputColorSpace)+";fill-opacity:"+n.opacity,X(a,s)}function K(e,t,i){let r=t.x-e.x,o=t.y-e.y;const n=r*r+o*o;if(0===n)return;const s=i/Math.sqrt(n);r*=s,o*=s,t.x+=r,t.y+=o,e.x-=r,e.y-=o}function X(e,t){p===e?d+=t:(Q(),p=e,d=t)}function Q(){d&&(u=function(e){if(null==B[e])return B[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==g&&B[e].setAttribute("shape-rendering","crispEdges"),B[e];return B[e]}(m++),u.setAttribute("d",d),u.setAttribute("style",p),F.appendChild(u)),d="",p=""}this.domElement=F,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.overdraw=.5,this.outputColorSpace=A,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":g=1;break;case"low":g=0}},this.setClearColor=function(e){E.set(e)},this.setPixelRatio=function(){},this.setSize=function(e,t){r=e,o=t,n=r/2,a=o/2,F.setAttribute("viewBox",-n+" "+-a+" "+r+" "+o),F.setAttribute("width",r),F.setAttribute("height",o),b.min.set(-n,-a),b.max.set(n,a)},this.getSize=function(){return{width:r,height:o}},this.setPrecision=function(e){f=e},this.clear=function(){I(),F.style.backgroundColor=E.getStyle(v.outputColorSpace)},this.render=function(r,o){if(o instanceof L==!1)return void console.error("THREE.SVGRenderer.render: camera is not an instance of Camera.");const s=r.background;s&&s.isColor?(I(),F.style.backgroundColor=s.getStyle(v.outputColorSpace)):!0===this.autoClear&&this.clear(),v.info.render.vertices=0,v.info.render.faces=0,D.copy(o.matrixWorldInverse),N.multiplyMatrices(o.projectionMatrix,D),e=U.projectScene(r,o,this.sortObjects,this.sortElements),t=e.elements,i=e.lights,k.getNormalMatrix(o.matrixWorldInverse),function(e){M.setRGB(0,0,0),T.setRGB(0,0,0),C.setRGB(0,0,0);for(let t=0,i=e.length;t<i;t++){const i=e[t],r=i.color;i.isAmbientLight?(M.r+=r.r,M.g+=r.g,M.b+=r.b):i.isDirectionalLight?(T.r+=r.r,T.g+=r.g,T.b+=r.b):i.isPointLight&&(C.r+=r.r,C.g+=r.g,C.b+=r.b)}}(i),d="",p="";for(let e=0,i=t.length;e<i;e++){const i=t[e],r=i.material;if(void 0!==r&&0!==r.opacity)if(x.makeEmpty(),i instanceof ae)l=i,l.x*=n,l.y*=-a,H(l,i,r);else if(i instanceof se)l=i.v1,c=i.v2,l.positionScreen.x*=n,l.positionScreen.y*=-a,c.positionScreen.x*=n,c.positionScreen.y*=-a,x.setFromPoints([l.positionScreen,c.positionScreen]),!0===b.intersectsBox(x)&&V(l,c,r);else if(i instanceof oe){if(l=i.v1,c=i.v2,h=i.v3,l.positionScreen.z<-1||l.positionScreen.z>1)continue;if(c.positionScreen.z<-1||c.positionScreen.z>1)continue;if(h.positionScreen.z<-1||h.positionScreen.z>1)continue;l.positionScreen.x*=n,l.positionScreen.y*=-a,c.positionScreen.x*=n,c.positionScreen.y*=-a,h.positionScreen.x*=n,h.positionScreen.y*=-a,this.overdraw>0&&(K(l.positionScreen,c.positionScreen,this.overdraw),K(c.positionScreen,h.positionScreen,this.overdraw),K(h.positionScreen,l.positionScreen,this.overdraw)),x.setFromPoints([l.positionScreen,c.positionScreen,h.positionScreen]),!0===b.intersectsBox(x)&&W(l,c,h,i,r)}}Q(),r.traverseVisible((function(e){if(e.isSVGObject){if(z.setFromMatrixPosition(e.matrixWorld),z.applyMatrix4(N),z.z<-1||z.z>1)return;const t=z.x*n,i=-z.y*a,r=e.node;r.setAttribute("transform","translate("+t+","+i+")"),F.appendChild(r)}}))}}}export{V as CopyShader,J as EffectComposer,k as Font,te as LuminosityHighPassShader,G as MaskPass,H as OrbitControls,W as Pass,$ as RenderPass,ce as SVGRenderer,Z as ShaderPass,ee as SimplexNoise,_ as TextGeometry,ie as UnrealBloomPass};
